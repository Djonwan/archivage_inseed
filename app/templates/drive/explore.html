<!-- app/templates/drive/explore.html -->
{% extends "base.html" %}
{% block title %}Exploration DSDS{% endblock %}

{% block content %}
<div class="sticky-top bg-white border-bottom pt-3 pb-2" style="top: 70px; z-index: 998;">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <h2 class="fw-bold mb-0">Exploration des documents</h2>

    <!-- FILTRES PUISSANTS -->
    <div class="btn-group shadow-sm" role="group">
      <input type="radio" class="btn-check" name="folderFilter" id="filterAll" autocomplete="off" checked>
      <label class="btn btn-outline-primary" for="filterAll">
        Tous
      </label>

      <input type="radio" class="btn-check" name="folderFilter" id="filterPersonal" autocomplete="off">
      <label class="btn btn-outline-warning" for="filterPersonal">
        Mes personnels
      </label>

      <input type="radio" class="btn-check" name="folderFilter" id="filterSharedByMe" autocomplete="off">
      <label class="btn btn-outline-primary" for="filterSharedByMe">
        Partagés par moi
      </label>

      <input type="radio" class="btn-check" name="folderFilter" id="filterReceived" autocomplete="off">
      <label class="btn btn-outline-success" for="filterReceived">
        Reçus
      </label>
    </div>
  </div>
</div>

<div class="container-fluid p-4">
  <div id="folderList">
    {% include 'drive/_folder_list.html' %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const folderList = document.getElementById('folderList');

  // Écoute des boutons radio
  document.querySelectorAll('input[name="folderFilter"]').forEach(radio => {
    radio.addEventListener('change', applyFilter);
  });

  function applyFilter() {
    const filterValue = document.querySelector('input[name="folderFilter"]:checked').id;

    let visibleCount = 0;

    document.querySelectorAll('.folder-card').forEach(card => {
      const isPersonal = card.dataset.isPersonal === 'true';
      const isOwner = card.dataset.isOwner === 'true';

      let show = false;

      if (filterValue === 'filterAll') {
        show = true;
      } else if (filterValue === 'filterPersonal') {
        show = isPersonal;
      } else if (filterValue === 'filterSharedByMe') {
        show = isOwner && !isPersonal;
      } else if (filterValue === 'filterReceived') {
        show = !isOwner;
      }

      card.style.display = show ? 'block' : 'none';
      if (show) visibleCount++;
    });

    // Message personnalisé si aucun résultat
    const existingMsg = folderList.querySelector('.no-results-msg');
    if (existingMsg) existingMsg.remove();

    if (visibleCount === 0) {
      let message = '';
      let icon = '';
      let btnText = '';
      let btnLink = '';

      if (filterValue === 'filterPersonal') {
        icon = 'bi-person-lock';
        message = 'Vous n’avez aucun dossier personnel.';
        btnText = 'Créer un dossier personnel';
        btnLink = "{{ url_for('drive.create_folder') }}";
      } else if (filterValue === 'filterSharedByMe') {
        icon = 'bi-share-fill';
        message = 'Vous n’avez partagé aucun dossier.';
        btnText = 'Créer et partager un dossier';
        btnLink = "{{ url_for('drive.create_folder') }}";
      } else if (filterValue === 'filterReceived') {
        icon = 'bi-box-arrow-in-down';
        message = 'Aucun dossier partagé avec vous.';
        btnText = 'Explorer les dossiers publics';
        btnLink = "{{ url_for('drive.explore') }}";
      }

      folderList.innerHTML = `
        <div class="col-12 text-center text-muted py-5 no-results-msg">
          <i class="bi ${icon}" style="font-size: 4.5rem; opacity: 0.4;"></i>
          <p class="mt-4 fs-4">${message}</p>
          <a href="${btnLink}" class="btn btn-lg btn-outline-primary mt-3">
            ${btnText}
          </a>
        </div>
      `;
    }
  }

  // Lancer le filtre au chargement (au cas où un filtre est pré-sélectionné)
  applyFilter();
});
</script>
{% endblock %}