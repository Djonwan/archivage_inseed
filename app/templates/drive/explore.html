<!-- app/templates/drive/explore.html -->
{% extends "base.html" %}
{% block title %}Exploration DSDS{% endblock %}

{% block content %}
<div class="sticky-top bg-white border-bottom pt-3 pb-2" style="top: 70px; z-index: 998;">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <h2 class="fw-bold mb-0">Exploration des documents</h2>

    <!-- TOGGLE : Afficher seulement mes dossiers personnels -->
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="personalOnlyToggle" style="transform: scale(1.4);">
      <label class="form-check-label fw-bold text-primary" for="personalOnlyToggle">
        <i class="bi bi-person-lock"></i> Mes dossiers personnels uniquement
      </label>
    </div>
  </div>
</div>

<div class="container-fluid p-4">
  <div id="folderList">
    {% include 'drive/_folder_list.html' %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const toggle = document.getElementById('personalOnlyToggle');
  const folderList = document.getElementById('folderList');

  toggle.addEventListener('change', function () {
    const isPersonalOnly = this.checked;

    // Masquer/Afficher les cartes
    document.querySelectorAll('.folder-card').forEach(card => {
      const isPersonal = card.dataset.isPersonal === 'true';
      if (isPersonalOnly) {
        card.style.display = isPersonal ? 'block' : 'none';
      } else {
        card.style.display = 'block';
      }
    });

    // Message si aucun dossier personnel
    const visibleCards = document.querySelectorAll('.folder-card[style*="display: block"], .folder-card:not([style])');
    const noFolderMsg = folderList.querySelector('.no-personal-folder');
    if (isPersonalOnly && visibleCards.length === 0) {
      if (!noFolderMsg) {
        folderList.innerHTML = `
          <div class="col-12 text-center text-muted py-5">
            <i class="bi bi-person-lock" style="font-size: 4rem; opacity: 0.5;"></i>
            <p class="mt-4 fs-5">Vous n'avez aucun dossier personnel pour le moment.</p>
            <a href="{{ url_for('drive.create_folder') }}" class="btn btn-outline-primary mt-3">
              <i class="bi bi-plus-circle"></i> Cr√©er mon premier dossier personnel
            </a>
          </div>`;
      }
    } else if (!isPersonalOnly && folderList.querySelector('.no-personal-folder')) {
      location.reload(); // recharge proprement
    }
  });
});
</script>
{% endblock %}