<!-- app/templates/drive/explore.html -->
{% extends "base.html" %}
{% block title %}Exploration DSDS{% endblock %}

{% block content %}
<div class="sticky-top bg-white border-bottom pt-3 pb-2" style="top: 70px; z-index: 998;">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <h2 class="fw-bold mb-0 text-dark">Exploration des documents</h2>

    <!-- FILTRES ÉLÉGANTS, DOUX & PROFESSIONNELS -->
    <div class="btn-group shadow-sm rounded-pill overflow-hidden border" role="group" style="border-color: #dee2e6 !important;">
      
      <input type="radio" class="btn-check" name="folderFilter" id="filterAll" autocomplete="off" checked>
      <label class="btn btn-outline-secondary fw-semibold px-4 py-2" for="filterAll">
        Tous
      </label>

      <input type="radio" class="btn-check" name="folderFilter" id="filterPersonal" autocomplete="off">
      <label class="btn btn-outline-warning fw-semibold px-4 py-2 border-warning-subtle" for="filterPersonal">
        Mes personnels
      </label>

      <input type="radio" class="btn-check" name="folderFilter" id="filterSharedByMe" autocomplete="off">
      <label class="btn btn-outline-info fw-semibold px-4 py-2 border-info-subtle" for="filterSharedByMe">
        Partagés par moi
      </label>

      <input type="radio" class="btn-check" name="folderFilter" id="filterReceived" autocomplete="off">
      <label class="btn btn-outline-success fw-semibold px-4 py-2 border-success-subtle" for="filterReceived">
        Reçus
      </label>
    </div>
  </div>
</div>

<div class="container-fluid p-4">
  <div id="folderList">
    {% include 'drive/_folder_list.html' %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const folderList = document.getElementById('folderList');

  // Appliquer le filtre
  document.querySelectorAll('input[name="folderFilter"]').forEach(radio => {
    radio.addEventListener('change', applyFilter);
  });

  function applyFilter() {
    const filterValue = document.querySelector('input[name="folderFilter"]:checked').id;
    let visibleCount = 0;

    document.querySelectorAll('.folder-card').forEach(card => {
      const isPersonal = card.dataset.isPersonal === 'true';
      const isOwner = card.dataset.isOwner === 'true';

      let show = false;
      if (filterValue === 'filterAll') show = true;
      else if (filterValue === 'filterPersonal') show = isPersonal;
      else if (filterValue === 'filterSharedByMe') show = isOwner && !isPersonal;
      else if (filterValue === 'filterReceived') show = !isOwner;

      card.style.display = show ? 'block' : 'none';
      if (show) visibleCount++;
    });

    // Message doux et pro quand aucun résultat
    const existingMsg = folderList.querySelector('.no-results-msg');
    if (existingMsg) existingMsg.remove();

    if (visibleCount === 0) {
      let config = {
        filterAll: { icon: 'bi-folder-symlink', msg: 'Aucun dossier disponible', btn: 'Créer un dossier', link: "{{ url_for('drive.create_folder') }}" },
        filterPersonal: { icon: 'bi-person-lock', msg: 'Vous n’avez aucun dossier personnel.', btn: 'Créer un dossier personnel', link: "{{ url_for('drive.create_folder') }}" },
        filterSharedByMe: { icon: 'bi-share-fill', msg: 'Vous n’avez partagé aucun dossier.', btn: 'Créer et partager', link: "{{ url_for('drive.create_folder') }}" },
        filterReceived: { icon: 'bi-inbox', msg: 'Aucun dossier partagé avec vous.', btn: 'Explorer les dossiers', link: "{{ url_for('drive.explore') }}" }
      };

      const { icon, msg, btn, link } = config[filterValue] || config.filterAll;

      folderList.innerHTML = `
        <div class="col-12 text-center text-muted py-5 no-results-msg">
          <i class="bi ${icon} mb-4" style="font-size: 4.5rem; opacity: 0.35;"></i>
          <h4 class="mb-3">${msg}</h4>
          <a href="${link}" class="btn btn-outline-primary px-4 py-2 fw-semibold">
            ${btn}
          </a>
        </div>
      `;
    }
  }

  applyFilter(); // au chargement
});
</script>
{% endblock %}